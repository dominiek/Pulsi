<!DOCTYPE html>
<html>
	<head>
		<title>Pulsi</title>
		<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script>
		<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.5/jquery-ui.min.js"></script>
		<script type="text/javascript" src="javascripts/underscore-min.js"></script>
		<script type="text/javascript" src="javascripts/sammy-0.6.1.min.js"></script>
		<script type="text/javascript" src="javascripts/highcharts.js"></script>
		<script type="text/javascript" src="javascripts/jquery.truncatable.js"></script>
    <script type="text/javascript" src="../javascripts/jquery.json-2.2.min.js"></script>
    <script src="http://cdn.socket.io/stable/socket.io.js"></script>
		<script type="text/javascript" src="javascripts/companies.js"></script>
		<script type="text/javascript" src="javascripts/company_chart.js"></script>
		<script type="text/javascript" src="javascripts/users.js"></script>
		<script type="text/javascript" src="javascripts/common.js"></script>
		<script type="text/javascript">
			var companyIdentifier;
			
			$(document).ready(function(){
				
				var sammy = $.sammy(function() {
					this.get('#/:identifier', function() {
						companyIdentifier = this.params['identifier'];
						longCompanyDetails();
						companies.info(companyIdentifier, function(company) {
	  						graphCompany(company);
							//showChromeNotification('test notification');
						});
						users.current(function(user) {
						  companies.subscribe(user.username, companyIdentifier, function(response) {
						    alert("New stock value: "+response.activityObject.value);
					    });
						});
					});
				});
				sammy.run();
			});
			
			function longCompanyDetails(){
				$('#info').html('');
				var stockValue;
				companies.info(companyIdentifier, function(companyInfo) {
					stockValue = companyInfo.current_value;
				});
				companies.crunchbaseInfo(companyIdentifier, function(companyInfo) {
					//$('<h1 id="company_name">'+companyInfo.name+'</h1>').appendTo('#info');
					$('<a href="'+companyInfo.homepage_url+'" id="company_url" target="_blank"><img src="'+crunchbaseUrl+companyInfo.image.available_sizes[0][1]+'" id="company_logo" alt="'+companyInfo.name+'" /></a>').appendTo('#info');
					if(stockValue){
						$('<p><strong>Value:</strong> <span id="company_value">'+stockValue+'</span></p>').appendTo('#info');
					}
					if(companyInfo.twitter_username){
						$('<p><strong>Twitter:</strong> <a href="http://twitter.com/#!/'+companyInfo.twitter_username+'" id="company_twitter" target="_blank">'+companyInfo.twitter_username+'</a></p>').appendTo('#info');
					}
					
					$('<p><strong>Description:</strong> <span id="company_description">'+companyInfo.overview+'</span></p>').appendTo('#info');
					$('#company_description a').each(function(){
						var $t = jQuery(this);
						    $t.after($t.text());
						    $t.remove();
					});
					$('#company_description').truncatable({	limit: 500, more: 'read more', less: true, hideText: 'hide' });
				});
			}
			
		</script>
		<link rel="stylesheet" type="text/css" href="http://yui.yahooapis.com/2.8.1/build/reset/reset-min.css">
		<link rel="stylesheet" type="text/css" href="css/common.css">
	</head>
	<body>
		<div id="head">
			<p id="userinfo">
				<a href="#" onclick="userLogout(); return false;" class="logout_link">Logout</a>
			</p>
			<div id="logo"></div>
			<p class="dashboard_link">Go to <a href="dashboard.html">Dashboard</a></p>
			<div class="clear"><!-- // --></div>
		</div>
		<div id="root">
			<div id="content" class="clearfix">
				<div class="clearfix">
					<div id="info"></div>
					<div id="company_chart"></div>
				</div>
				<div id="stock">
					<h2>My stock options</h2>
					<form>
						<p><input type="text" name="buy_stock_count" size="3" value="100" /><button>Buy Stock &rarr;</button></p>
						<p><input type="text" name="sell_stock_count" size="3" value="100" /><button>Sell Stock &rarr;</button></p>
					</form>
				</div>
			</div>
			<div id="footer">
				<h3>Pulsi</h3>
				<p><a href="#" title="Copyright &amp; shit" onclick="alert('http://github.com/dominiek/Pulsi');return false;">Copyright &amp; shit</a></p>
				<div class="clear"><!-- // --></div>
			</div>
		</div>
	</body>
</html>