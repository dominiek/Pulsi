<!DOCTYPE html>
<html>
	<head>
		<title>Pulsi</title>
		<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script>
		<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.5/jquery-ui.min.js"></script>
		<script type="text/javascript" src="javascripts/sammy-0.6.1.min.js"></script>
		<script type="text/javascript" src="javascripts/highcharts.js"></script>
		<script type="text/javascript" src="javascripts/companies.js"></script>
		<script type="text/javascript">
			var baseUrl = 'http://api.crunchbase.com/';
			var companyName;
			var companyChart;
			
			$(document).ready(function(){
				
				var sammy = $.sammy(function() {
					this.get('#/:name', function() {
						companyName = this.params['name'];
						showCompanyDetails();
						graphCompany();
					});
				});
				sammy.run();
			});
			
			function showCompanyDetails(){
				$('#info').html('');
				companies.crunchbaseInfo(companyName, function(companyInfo) {
					$('<h1 id="company_name">'+companyInfo.name+'</h1>').appendTo('#info');
					$('<a href="'+companyInfo.homepage_url+'" id="company_url" target="_blank"><img src="'+baseUrl+companyInfo.image.available_sizes[0][1]+'" id="company_logo" alt="logo" /></a>').appendTo('#info');
					$('<p><strong>Value:</strong> <span id="company_value"></span></p>').appendTo('#info');
					if(companyInfo.twitter_username){
						$('<p><strong>Twitter:</strong> <a href="http://twitter.com/#!/'+companyInfo.twitter_username+'" id="company_twitter" target="_blank">'+companyInfo.twitter_username+'</a></p>').appendTo('#info');
					}
					$('<p><strong>Description:</strong> <span id="company_description">'+companyInfo.overview+'</span></p>').appendTo('#info');					
				});
				companies.info(companyName, function(companyInfo) {
					$('#company_value').html(companyInfo.current_value);
				});
			}
			
			function graphCompany(){
				companyChart = new Highcharts.Chart({
					chart: {
						renderTo: 'company_chart',
						zoomType: 'x'
					},
				        title: {
						text: 'Stock Value'
					},
				        subtitle: {
						text: 'Click and drag in the plot area to zoom in'
					},
					yAxis: {
						title: {
							text: ''
						},
						//min: 0.6,
						startOnTick: false,
						showFirstLabel: false
					},
					tooltip: {
						formatter: function() {
							return 'Stock Value = '+ Highcharts.numberFormat(this.y, 2);
						}
					},
					legend: {
						enabled: false
					},
					plotOptions: {
						area: {
							fillColor: {
								linearGradient: [0, 0, 0, 300],
								stops: [
									[0, '#4572A7'],
									[1, 'rgba(2,0,0,0)']
								]
							},
							lineWidth: 1,
							marker: {
								enabled: false,
								states: {
									hover: {
										enabled: true,
										radius: 5
									}
								}
							},
							shadow: false,
							states: {
								hover: {
									lineWidth: 1						
								}
							}
						}
					},

					series: [{
						type: 'area',
						pointInterval: 1,
						pointStart: 0,
						data: [
							12, 34, 500, 1000, 123, 242, 300
						]
					}]
				});
			}
			
		</script>
		<link rel="stylesheet" type="text/css" href="http://yui.yahooapis.com/2.8.1/build/reset/reset-min.css">
		<link rel="stylesheet" type="text/css" href="css/common.css">
	</head>
	<body>
		<div id="root">
			<div id="head">
				<div id="logo">Pul&#36;i</div>
			</div>
			<div id="content" class="clearfix">
				<div class="clearfix">
					<div id="stock">
						<h2>My stock options</h2>
						<form>
							<p><input type="text" name="buy_stock_count" size="3" value="100" /><button>Buy Stock &rarr;</button></p>
							<p><input type="text" name="sell_stock_count" size="3" value="100" /><button>Sell Stock &rarr;</button></p>
						</form>
					</div>
					<div id="company_chart"></div>
				</div>
				<div id="info"></div>
			</div>
		</div>
	</body>
</html>